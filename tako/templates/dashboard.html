{% extends "base.html" %}
{% load tako_filters %}

{% block head %}
{% endblock %}

{% block main %}
  <h1>Dashboard</h1>
  <p>Now: <span class="number-font">{{ now|iso_time }}</span></p>

  <section>
    <div id="event-drops-chart" class="event-drops-container" style="height: 170px;">
      <div class="loading loading-lg" style="position: relative; top: 40px;"></div>
    </div>
  </section>

  <section>
    <h2>Executions
      <a class="sublink" href="{% url 'executions' %}">more</a>
    </h2>

    {% include "executions_table.html" with object_list=all_list %}
  </section>

  <section>
    <h2>Executions [SUCCESS]
      <a class="sublink" href="{% url 'executions' %}?{{ 'SUCCESS'|status_params|encode_params_with_page }}">more</a>
    </h2>
    {% include "executions_table.html" with object_list=success_list %}
  </section>

  <section>
    <h2>Executions [Other statuses]
      <a class="sublink" href="{% url 'executions' %}?{{ 'SUCCESS'|status_params:True|encode_params_with_page }}">more</a>
    </h2>
    {% include "executions_table.html" with object_list=error_list %}
  </section>
{% endblock %}

{% block body_end %}
  <script src="/static/d3.min.js"></script>
  <script src="/static/event-drops@1.2.0.min.js"></script>
  <script src="/static/event-drops-utils.js"></script>
  <script src="/static/execution_table.js"></script>
  <script>
    (function() {
      var chart_el = document.getElementById('event-drops-chart');

      TAKO.fetchExecutionsTsdata().then(data => {
        document.querySelectorAll('.loading').forEach(function(e) {
          e.remove();
        });
        TAKO.draw_event_drops(chart_el, data, {left: -60, right: 10, bottom: 0});
        chart_el.removeAttribute('style');
      })
    })();
  </script>
{% endblock %}
